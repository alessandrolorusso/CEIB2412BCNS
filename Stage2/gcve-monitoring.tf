module "secret-manager" {
  source  = "GoogleCloudPlatform/secret-manager/google"
  version = "~> 0.1"
  project_id = var.project
  secrets = [
    {
      name                     = var.secret_vsphere_server
      secret_data              = data.local_file.vcenter-fqdn.content
      automatic_replication    = true
    },
    {
      name                     = var.secret_vsphere_user
      secret_data              = var.vsphere_user
      automatic_replication    = true
    },
  ]
}

module "gcve-monitoring" {
  depends_on = [ module.secret-manager ]
  source                  = "github.com/GoogleCloudPlatform/gcve-iac-foundations/modules/gcve-monitoring"
  gcve_region             = var.gcve_region
  project                 = var.project
  secret_vsphere_server   = var.secret_vsphere_server
  secret_vsphere_user     = var.secret_vsphere_user
  secret_vsphere_password = var.secret
  vm_mon_name             = var.vm_mon_name
  vm_mon_type             = var.vm_mon_type
  vm_mon_zone             = var.vm_mon_zone
  sa_gcve_monitoring      = var.sa_gcve_monitoring
  subnetwork              = var.subnetwork
  create_dashboards       = var.create_dashboards
}